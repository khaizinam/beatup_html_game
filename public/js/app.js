(()=>{"use strict";var e={"4K":["ArrowLeft","ArrowDown","ArrowUp","ArrowRight"],"8K":["ArrowLeft","ArrowDown","ArrowUp","ArrowRight","KeyA","KeyS","KeyD","KeyF"]},t={EASY:{noteCountBonus:-1,speedMultiplier:.6},NORMAL:{noteCountBonus:0,speedMultiplier:1},HARD:{noteCountBonus:1,speedMultiplier:1.2},EXPERT:{noteCountBonus:2,speedMultiplier:1.5}},i=[{id:"sorry_bao_thi",name:"Sorry - Bảo Thy",file:"public/music/sorry_bao_thi.mp3",duration:240,segments:[{start:0,end:30,mode:1,bpm:100,label:"Warm Up"},{start:30,end:120,mode:2,bpm:130,label:"Normal"},{start:120,end:180,mode:3,bpm:160,label:"Fast"},{start:180,end:240,mode:4,bpm:190,label:"Super Fast"}]},{id:"khoc_dong_nhi",name:"Khóc - Đông Nhi",file:"public/music/Khoc-Dong-Nhi.mp3",duration:240,segments:[{start:0,end:30,mode:1,bpm:100,label:"Warm Up"},{start:30,end:120,mode:2,bpm:130,label:"Normal"},{start:120,end:180,mode:3,bpm:160,label:"Fast"},{start:180,end:240,mode:4,bpm:190,label:"Super Fast"}]},{id:"ten_minutes",name:"10 Minutes - Lee Hyori",file:"public/music/10_minutes.mp3",duration:160,segments:[{start:0,end:30,mode:1,bpm:100,label:"Warm Up"},{start:30,end:80,mode:2,bpm:130,label:"Normal"},{start:80,end:120,mode:3,bpm:160,label:"Fast"},{start:120,end:160,mode:4,bpm:190,label:"Super Fast"}]}];function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,o(n.key),n)}}function o(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,t||"default");if("object"!=n(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}var r=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sounds={key:new Audio("public/audio/key.wav"),space:new Audio("public/audio/space.wav"),perfect:new Audio("public/audio/perfect.wav"),great:new Audio("public/audio/great.wav"),bad:new Audio("public/audio/bad.wav"),miss:new Audio("public/audio/miss.wav"),start:new Audio("public/audio/game-start.mp3")},this.music=null,Object.values(this.sounds).forEach(function(e){return e.volume=.4}),this.sounds.perfect&&(this.sounds.perfect.volume=.6)},t=[{key:"playMusic",value:function(e){this.music&&this.music.pause(),this.music=new Audio(e),this.music.volume=.5,this.music.play().catch(function(e){return console.warn("Music load failed or autoplay blocked",e)})}},{key:"playBGM",value:function(){this.bgm||(this.bgm=new Audio("public/audio/background-loop.mp3"),this.bgm.loop=!0,this.bgm.volume=.3),this.bgm.paused&&this.bgm.play().catch(function(e){return console.log("BGM Auto-play blocked")})}},{key:"stopBGM",value:function(){this.bgm&&(this.bgm.pause(),this.bgm.currentTime=0)}},{key:"toggleMusic",value:function(e){this.music&&(e?this.music.play():this.music.pause())}},{key:"stopMusic",value:function(){this.music&&(this.music.pause(),this.music.currentTime=0)}},{key:"playKey",value:function(){this.play(this.sounds.key)}},{key:"playStart",value:function(){this.play(this.sounds.start)}},{key:"playJudgement",value:function(e){var t=e.toLowerCase();this.sounds[t]&&this.play(this.sounds[t])}},{key:"play",value:function(e){if(e){var t=e.cloneNode();t.volume=e.volume,t.play().catch(function(e){})}}}],t&&s(e.prototype,t),i&&s(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}();function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function u(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,l(n.key),n)}}function l(e){var t=function(e,t){if("object"!=a(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==a(t)?t:t+""}var c=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.measureProgress=0,this.bpm=100,this.measureDuration=2400,this.barX=100,this.barY=500,this.barW=600,this.targetPercent=.85,this.zoneWidth=.1},(t=[{key:"updateSpeed",value:function(e){this.bpm=e,this.measureDuration=6e4/this.bpm*4}},{key:"update",value:function(e){this.measureProgress+=e/this.measureDuration,this.measureProgress>=1&&(this.game.noteSystem.hasPendingNotes()&&(this.game.triggerJudgement("MISS","red"),this.game.noteSystem.reset()),this.measureProgress=0,this.game.noteSystem.generateSequence()),this.game.config.autoPlay&&this.game.noteSystem.isComplete()&&Math.abs(this.measureProgress-this.targetPercent)<.005&&(this.game.triggerJudgement("PERFECT","#0ff"),this.game.noteSystem.reset(),this.game.audioSystem.play("space"))}},{key:"draw",value:function(e){e.fillStyle="#333",e.fillRect(this.barX,this.barY,this.barW,10);var t=this.barX+(this.targetPercent-this.zoneWidth/2)*this.barW;e.fillStyle="rgba(0, 255, 255, 0.3)",e.fillRect(t,this.barY-5,this.zoneWidth*this.barW,20);var i=this.barX+this.targetPercent*this.barW;e.fillStyle="#fff",e.fillRect(i-1,this.barY-10,2,30);var n=this.barX+this.measureProgress*this.barW;e.beginPath(),e.arc(n,this.barY+5,12,0,2*Math.PI),e.fillStyle="#0ff",e.shadowBlur=10,e.shadowColor="#0ff",e.fill(),e.shadowBlur=0,Math.abs(this.measureProgress-this.targetPercent)<this.zoneWidth/2&&(e.strokeStyle="white",e.lineWidth=2,e.stroke())}},{key:"checkTiming",value:function(){var e=Math.abs(this.measureProgress-this.targetPercent);return e<.01?"PERFECT":e<.03?"GREAT":e<.06?"COOL":e<.1?"BAD":"MISS"}}])&&u(e.prototype,t),i&&u(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}();function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function h(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function d(e){var t=function(e,t){if("object"!=m(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=m(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==m(t)?t:t+""}var f=function(){return i=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.sequence=[],this.inputIndex=0},(n=[{key:"generateSequence",value:function(){this.sequence=[],this.inputIndex=0;var i=3,n=this.game.level;1===n?i=3:2===n?i=4+(Math.random()>.5?1:0):3===n?i=6:4===n&&(i=8);for(var s=t[this.game.config.diff],o=Math.min(8,i+s.noteCountBonus),r=e[this.game.config.mode],a=0;a<o;a++){var u=r[Math.floor(Math.random()*r.length)];this.sequence.push({key:u,state:"PENDING"})}this.sequence.length>0&&(this.sequence[0].state="ACTIVE")}},{key:"hasPendingNotes",value:function(){return this.sequence.some(function(e){return"DONE"!==e.state})}},{key:"reset",value:function(){this.sequence=[],this.inputIndex=0}},{key:"handleInput",value:function(e){if(0!==this.sequence.length&&!(this.inputIndex>=this.sequence.length)){var t=this.sequence[this.inputIndex];e===t.key?(t.state="DONE",this.inputIndex++,this.game.audioSystem.playKey(),this.inputIndex<this.sequence.length&&(this.sequence[this.inputIndex].state="ACTIVE")):(this.inputIndex=0,this.sequence.forEach(function(e){return e.state="PENDING"}),this.sequence.length>0&&(this.sequence[0].state="ACTIVE"),this.game.triggerJudgement("RESET","orange"))}}},{key:"updateAutoPlay",value:function(){if(this.sequence.length>0&&this.inputIndex<this.sequence.length){var e=this.sequence[this.inputIndex];(Math.random()>.8||0===this.inputIndex)&&this.handleInput(e.key)}}},{key:"isComplete",value:function(){return this.sequence.length>0&&this.inputIndex===this.sequence.length}},{key:"draw",value:function(e){var t=this,i=400-40*this.sequence.length;e.save(),e.textAlign="center",e.textBaseline="middle",this.sequence.forEach(function(n,s){var o=i+80*s;e.save(),e.translate(o,300),t.drawNote(e,n),e.restore()}),e.restore()}},{key:"drawNote",value:function(e,t){var i={ArrowLeft:{bg:"#FF5252",border:"#D32F2F",shadow:"#FF5252"},ArrowDown:{bg:"#448AFF",border:"#1976D2",shadow:"#448AFF"},ArrowUp:{bg:"#FFCA28",border:"#F57C00",shadow:"#FFCA28"},ArrowRight:{bg:"#69F0AE",border:"#388E3C",shadow:"#69F0AE"},default:{bg:"#9E9E9E",border:"#616161",shadow:"#9E9E9E"}},n=i[t.key]||i.default,s="DONE"===t.state,o="ACTIVE"===t.state,r=n.bg,a=n.border,u=n.shadow,l=0,c=1;s?l=15:c=.3,e.shadowColor=u,e.shadowBlur=l,e.shadowOffsetX=0,e.shadowOffsetY=0,e.fillStyle=r,e.save(),e.globalAlpha=c;var m=60;e.fillRect(-30,-30,m,m),e.restore(),e.lineWidth=3,o?(e.lineWidth=4,e.strokeStyle="#FFFFFF",e.save(),e.shadowColor="#FFFFFF",e.shadowBlur=10,e.strokeRect(-30,-30,m,m),e.restore()):(e.strokeStyle=a,s?e.strokeRect(-30,-30,m,m):(e.save(),e.globalAlpha=.5,e.strokeRect(-30,-30,m,m),e.restore()));var h=this.getChar(t.key);e.font="900 35px Arial",e.textAlign="center",e.textBaseline="middle",e.shadowBlur=0,e.lineWidth=4,e.strokeStyle="rgba(0,0,0, 0.8)",e.strokeText(h,0,2),e.fillStyle="#FFFFFF",e.fillText(h,0,2)}},{key:"getChar",value:function(e){return"ArrowUp"===e?"↑":"ArrowDown"===e?"↓":"ArrowLeft"===e?"←":"ArrowRight"===e?"→":e.replace("Key","")}}])&&h(i.prototype,n),s&&h(i,s),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,n,s}();function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function p(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,g(n.key),n)}}function g(e){var t=function(e,t){if("object"!=y(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==y(t)?t:t+""}var b=function(){return e=function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,document.addEventListener("keydown",function(e){return i.onKeyDown(e)})},t=[{key:"onKeyDown",value:function(e){if("MENU"!==this.game.state&&"GAMEOVER"!==this.game.state)if("Escape"!==e.code){if("PLAYING"===this.game.state)if("Space"!==e.code)this.game.noteSystem.handleInput(e.code);else if(this.game.noteSystem.isComplete()){var t=this.game.beatSystem.checkTiming(),i="white";"PERFECT"===t&&(i="#0ff"),"GREAT"===t&&(i="#0f0"),"COOL"===t&&(i="#00f"),"BAD"===t&&(i="#f00"),this.game.triggerJudgement(t,i),this.game.noteSystem.reset()}else this.game.triggerJudgement("MISS","red"),this.game.noteSystem.reset()}else this.game.togglePause()}}],t&&p(e.prototype,t),i&&p(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}();function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function S(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,w(n.key),n)}}function w(e){var t=function(e,t){if("object"!=v(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=v(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==v(t)?t:t+""}var E=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.scoreEl=document.getElementById("score"),this.comboEl=document.getElementById("combo"),this.levelEl=document.getElementById("level")},(t=[{key:"updateUI",value:function(){this.scoreEl.innerText=this.game.score,this.comboEl.innerText=this.game.combo,this.levelEl.innerText=this.game.level}},{key:"draw",value:function(e){var t=this,i=Math.max(0,this.game.songData.duration-this.game.elapsedTime),n=Math.floor(i/60),s=Math.floor(i%60).toString().padStart(2,"0");e.font="20px monospace",e.fillStyle="#fff",e.textAlign="center",e.fillText("TIME: ".concat(n,":").concat(s),400,30);var o=this.game.songData.segments.find(function(e){return t.game.elapsedTime>=e.start&&t.game.elapsedTime<e.end});o&&(e.font="bold 16px Arial",e.fillStyle="#FFD700",e.textAlign="center",e.fillText(o.label.toUpperCase(),400,55))}}])&&S(e.prototype,t),i&&S(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}();function A(e){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(e)}function T(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,k(n.key),n)}}function k(e){var t=function(e,t){if("object"!=A(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=A(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==A(t)?t:t+""}var I=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d"),this.state="MENU",this.lastTime=0,this.config={mode:"4K",diff:"NORMAL",songId:null,autoPlay:!1},this.songData=null,this.elapsedTime=0,this.score=0,this.combo=0,this.maxCombo=0,this.level=1,this.bpm=100,this.currentPhaseIdx=0,this.audioSystem=new r,this.beatSystem=new c(this),this.noteSystem=new f(this),this.inputSystem=new b(this),this.uiSystem=new E(this),this.initMenu(),this.audioSystem.playBGM(),this.loop=this.loop.bind(this),requestAnimationFrame(this.loop)},(n=[{key:"initMenu",value:function(){var e=this,t=document.getElementById("setting-song-list"),n=document.getElementById("setting-song");t.innerHTML="",i.forEach(function(e,i){var s=document.createElement("div");s.className="song-item"+(0===i?" active":""),s.dataset.id=e.id;var o=Math.floor(e.duration/60),r=e.duration%60,a="".concat(o,":").concat(r.toString().padStart(2,"0"));s.innerHTML='\n                <span class="song-name">'.concat(e.name,'</span>\n                <span class="song-duration">').concat(a,"</span>\n            "),s.onclick=function(){document.querySelectorAll(".song-item").forEach(function(e){return e.classList.remove("active")}),s.classList.add("active"),n.value=e.id},t.appendChild(s),0===i&&(n.value=e.id)});var s=function(e,t){var i=document.getElementById(e),n=document.getElementById(t),s=i.querySelectorAll(".selection-btn");s.forEach(function(e){e.onclick=function(){s.forEach(function(e){return e.classList.remove("active")}),e.classList.add("active"),n.value=e.dataset.value}})};s("setting-mode-group","setting-mode"),s("setting-diff-group","setting-diff"),document.getElementById("btn-start").onclick=function(){return e.startGame()},document.getElementById("btn-resume").onclick=function(){return e.resumeGame()},document.getElementById("btn-menu").onclick=function(){return e.quitToMenu()},document.getElementById("btn-home").onclick=function(){return e.showScreen("screen-menu")},document.getElementById("btn-replay").onclick=function(){return e.startGame()},this.showScreen("screen-menu")}},{key:"startGame",value:function(){var e=this;if(this.config.mode=document.getElementById("setting-mode").value,this.config.diff=document.getElementById("setting-diff").value,this.config.songId=document.getElementById("setting-song").value,this.config.autoPlay=document.getElementById("setting-auto").checked,this.songData=i.find(function(t){return t.id===e.config.songId}),!this.songData)return alert("Song not found!");this.score=0,this.combo=0,this.maxCombo=0,this.level=1,this.elapsedTime=0,this.currentPhaseIdx=0,this.bpm=this.songData.segments[0].bpm;var n=t[this.config.diff].speedMultiplier||1;this.bpm=this.songData.segments[0].bpm,this.beatSystem.updateSpeed(this.bpm*n),this.noteSystem.reset(),this.audioSystem.stopBGM(),this.uiSystem.updateUI(),document.getElementById("judgement").innerText="Ready?",document.getElementById("judgement").style.color="#fff",this.state="STARTING",this.audioSystem.playStart(),this.showScreen("screen-game"),setTimeout(function(){"STARTING"===e.state&&(e.audioSystem.playMusic(e.songData.file),e.state="PLAYING",e.elapsedTime=0)},2e3)}},{key:"togglePause",value:function(){"PLAYING"===this.state?(this.state="PAUSED",this.audioSystem.toggleMusic(!1),document.getElementById("modal-pause").classList.remove("hidden")):"PAUSED"===this.state&&this.resumeGame()}},{key:"resumeGame",value:function(){this.state="PLAYING",this.audioSystem.toggleMusic(!0),document.getElementById("modal-pause").classList.add("hidden")}},{key:"quitToMenu",value:function(){this.state="MENU",this.audioSystem.stopMusic(),this.audioSystem.playBGM(),this.showScreen("screen-menu"),document.getElementById("modal-pause").classList.add("hidden")}},{key:"endGame",value:function(){this.state="GAMEOVER",this.audioSystem.stopMusic(),this.audioSystem.playBGM(),this.showScreen("screen-result"),document.getElementById("res-song").innerText=this.songData.name,document.getElementById("res-score").innerText=this.score,document.getElementById("res-combo").innerText=this.maxCombo;var e="F";this.score>5e3?e="S":this.score>3e3?e="A":this.score>1e3&&(e="B"),document.getElementById("res-rank").innerText=e}},{key:"showScreen",value:function(e){document.querySelectorAll(".screen").forEach(function(e){return e.classList.remove("active")}),document.getElementById(e).classList.add("active")}},{key:"loop",value:function(e){var t=e-this.lastTime;if(this.lastTime=e,"PLAYING"===this.state){var i=this.audioSystem.music?this.audioSystem.music.currentTime:this.elapsedTime;Math.abs(i-this.elapsedTime)>.1?this.elapsedTime=i:this.elapsedTime+=t/1e3,this.update(t),this.draw()}else"PAUSED"===this.state?this.draw():"STARTING"===this.state&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawBackground(),this.ctx.fillStyle="white",this.ctx.font="bold 40px Arial",this.ctx.textAlign="center",this.ctx.fillText("READY...",400,300));requestAnimationFrame(this.loop)}},{key:"update",value:function(e){var i=this;if(this.elapsedTime>=this.songData.duration)this.endGame();else{var n=this.songData.segments.find(function(e){return i.elapsedTime>=e.start&&i.elapsedTime<e.end});if(n){var s=t[this.config.diff].speedMultiplier||1,o=n.bpm*s;o!==this.bpm&&(this.bpm=o,this.level=n.mode,this.beatSystem.updateSpeed(this.bpm),this.triggerJudgement(n.label,"#FFD700"))}this.config.autoPlay&&this.noteSystem.updateAutoPlay(),this.beatSystem.update(e)}}},{key:"draw",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawBackground(),this.beatSystem.draw(this.ctx),this.noteSystem.draw(this.ctx),this.uiSystem.draw(this.ctx)}},{key:"drawBackground",value:function(){this.ctx.fillStyle="#111",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.strokeStyle="#222",this.ctx.lineWidth=1;for(var e=0;e<800;e+=40)this.ctx.beginPath(),this.ctx.moveTo(e,0),this.ctx.lineTo(e,600),this.ctx.stroke();for(var t=0;t<600;t+=40)this.ctx.beginPath(),this.ctx.moveTo(0,t),this.ctx.lineTo(800,t),this.ctx.stroke();this.ctx.restore()}},{key:"triggerJudgement",value:function(e,t){var i=document.getElementById("judgement");if(i.innerText=e,i.style.color=t,i.style.transform="translateX(-50%) scale(1.5)",setTimeout(function(){return i.style.transform="translateX(-50%) scale(1)"},100),["PERFECT","GREAT","COOL","BAD","MISS"].includes(e)&&this.audioSystem.playJudgement(e),"MISS"===e||"BAD"===e||"RESET"===e)this.combo=0;else if(["PERFECT","GREAT","COOL"].includes(e)){this.combo++,this.combo>this.maxCombo&&(this.maxCombo=this.combo);var n=0;"PERFECT"===e&&(n=100),"GREAT"===e&&(n=50),"COOL"===e&&(n=10);var s=1;"EASY"===this.config.diff?s=.8:"NORMAL"===this.config.diff?s=1:"HARD"===this.config.diff?s=1.2:"EXPERT"===this.config.diff&&(s=1.5),this.score+=Math.floor(n*(1+Math.floor(this.combo/10))*s)}this.uiSystem.updateUI()}}])&&T(e.prototype,n),s&&T(e,s),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,s}();window.onload=function(){window.game=new I}})();